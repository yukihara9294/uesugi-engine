# デザインリファレンス

最終更新: 2025-06-11
更新者: Claude Code
更新内容: ダミーデータ時のデザイン仕様を詳細に記録

## 重要：デザインの基本方針
**現在の目標は、ダミーデータ作成時にGitHubに保存していた表現を完全にトレースすること**

## ダミーデータ時のデザイン仕様

### 1. 人流データ
- **パーティクル表現**：
  - サイズ: 固定2px（commit 001d4ff参照）
  - 色: シアン（#00FFFF）、マゼンタ（#FF00FF）、イエロー（#FFFF00）
  - アニメーション: ゆっくりと弧を描いて起点から終点へ移動
  - **北側迂回**: パーティクルは北側（緯度方向）に弧を描いて移動
  - フェードイン・フェードアウト: 最初の1/3でフェードイン、最後の1/3でフェードアウト
- **フローライン**：
  - 透明度の高い線が光ったり消えたりする
  - ぼかし効果あり

### 2. SNSヒートマップ
- **色合い**: commit 30d5553時の配色
  - グラデーション: 青→シアン→白→黄→オレンジ→赤
  - 透明度: 0.7
  - ぼかし半径: 30
- **カテゴリフィルター**：
  - 初期状態で全カテゴリ選択
  - 未選択時は全データ表示

### 3. 消費データ
- **3D棒グラフ**：
  - 高さ計算: sqrt(amount) / 50
  - ポリゴンサイズ: 0.00006（現在）
  - 透明度: 30%
  - 金額表記なし

### 4. 宿泊施設
- **3D表現**：
  - 色: #4A90E2（青）
  - 透明度: 50%（現在80%）
  - 高さ: 40m
  - **サイズと縦横比**: ダミーデータ時と同じ（要修正）

### 5. ランドマーク
- **ポイント表現**：
  - サイズ: 6px
  - 色: #FF6B6B（赤）
- **3D表現**：
  - 20m以上の建物を表示
  - カテゴリ別色分け

### 6. PLATEAU建物
- **3D表現**：
  - 色: #9B59B6（紫）
  - 透明度: 80%
  - 吹き出し情報: 建物名、階数、種別、高さ

### 7. イベント情報
- **表現方法**：
  - 影響範囲（薄い円）
  - マーカー（赤い円）
  - ラベル（イベント名）

## 現在の問題点と次回タスク

### 優先度：高
1. **人流データのパーティクル**
   - 北側迂回表現が正しく実装されていない
   - 以前の表現（弧を描く動き）に戻す必要あり

2. **ランドマークトグル**
   - ONにするとエラーが発生
   - 何も表示されない

### 優先度：中
3. **宿泊施設**
   - サイズと縦横比をダミーデータ時と同じに
   - 透明度を50%に変更（現在80%）

4. **SNSヒートマップ**
   - 地図上での表現が正しく反映されていない
   - 色合いをダミーデータ時のものに統一

## 技術的な注意点

### エラーの原因
- `Cannot read properties of undefined (reading 'sub')`: Mapboxの内部エラー
- 主にfill-extrusionレイヤーにPointデータを使用した際に発生
- 解決策: PointデータをPolygonに変換

### レイヤー管理
- 3Dレイヤー（fill-extrusion）はPolygonデータが必須
- レイヤーの表示/非表示切り替えは`layerMapping`で管理

## 参考コミット
- `30d5553`: 人流パーティクル色修正と消費データクラスタリング実装
- `001d4ff`: ズームレベル14に最適化した人流パーティクルシステム
- `cb0661d`: 人流データを最先端の3Dサイバーパンク表現に刷新
- `4569a29`: 人流パーティクルの視認性を大幅改善