# Uesugi Engine - 全国対応ソーシャルヒートマップ with AI因果推論

## 🎆 プロジェクト完成版 (2025-06-09)

本プロジェクトは、日本全国（広島県・東京都・大阪府・福岡県）のリアルワールドデータとソーシャルデータを
統合的に可視化し、AI因果推論による高度な分析を提供する最先端のプラットフォームです。

## プロダクト概要

ダッタラ株式会社が開発する「Uesugi Engine」の可視化フロントエンドとして、広島県での観光・移住・PR施策の効果を「見える化」するソーシャルヒートマップシステムです。
https://prtimes.jp/main/html/rd/p/000000001.000161362.html

## 主な機能

### 🌐 リアルワールドデータ
- **ランドマーク**: 観光地・主要施設を3D表示
- **宿泊施設**: 稼働率を棒グラフで可視化（実在ホテル名使用）
- **消費データ**: 商業施設での消費動向（観光地20倍表示）
- **人流データ**: 3Dサイバーパンク表現の光のフロー（赤緑交通信号配色）
- **イベント情報**: 実在会場での開催イベントと影響範囲
- **都市間移動**: 新幹線・高速道路・航空路線の可視化

### 📱 ソーシャルデータ  
- **SNS感情分析**: サイバーチックなヒートマップ
- **カテゴリ別分析**: 観光・グルメ・ショッピング等
- **感情スコア**: ポジティブ/ネガティブ分析
- **投稿数統計**: カテゴリ別リアルタイム集計

### 🤖 AI因果推論分析（新機能）
- **過去分析**: イベント成功要因の科学的分解
  - 天候・SNS・交通・季節性の因果効果を定量化
  - 反実仮想分析（What-ifシナリオ）
  - Double/Debiased Machine Learning (DML)使用
- **未来予測**: 高精度な来場者数予測
  - 95%信頼区間での予測
  - シナリオ別シミュレーション
  - 要因別寄与度の可視化

## システム構成

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   フロントエンド │     │   バックエンド   │     │   データソース   │
├─────────────────┤     ├─────────────────┤     ├─────────────────┤
│   React.js      │────▶│   FastAPI       │────▶│ OpenWeatherMap  │
│   Mapbox GL JS  │     │   PostgreSQL    │     │ e-Stat API      │
│   Material-UI   │◀────│   PostGIS       │     │ OpenStreetMap   │
│   Chart.js      │     │   Redis Cache   │     │ 国土数値情報     │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

## 技術スタック

- **フロントエンド**: React + Mapbox GL JS + Material-UI
- **バックエンド**: FastAPI + PostgreSQL + PostGIS
- **インフラ**: Docker Compose
- **可視化**: 3D表現、パーティクルアニメーション

## 環境構築

```bash
# リポジトリクローン
git clone [repository-url]
cd uesugi-engine

# 環境変数設定
cp .env.example .env
# .envファイルを編集してAPIキー等を設定

# Docker起動
docker-compose up -d

# ブラウザでアクセス
# フロントエンド: http://localhost:3000
# API仕様書: http://localhost:8000/docs
```

### 環境変数
`.env`ファイルを作成し、必要な設定を行います：

**重要**: Mapboxトークンは必須です。[Mapbox](https://www.mapbox.com/)でアカウントを作成し、
トークンを取得してください。

```
# Mapbox
REACT_APP_MAPBOX_ACCESS_TOKEN=your_mapbox_token_here

# その他のAPI
OPENWEATHERMAP_API_KEY=your_key_here
```

## 対応都道府県

現在、以下の4都道府県に対応しています：

- **広島県**: 完全対応（全機能利用可能）
- **東京都**: 完全対応（山手線・地下鉄路線含む）
- **大阪府**: 完全対応（環状線・地下鉄路線含む）
- **福岡県**: 完全対応（地下鉄路線含む）

各都道府県で実在の施設名・座標を使用し、リアルなデータ密度で表示されます。

## 使い方

1. **都道府県切り替え**: 左上のドロップダウンから選択
2. **レイヤー表示**: 左右のサイドバーでON/OFF切り替え
3. **AI分析**: 右上の「AI分析」ボタンから因果推論分析を起動
4. **時系列フィルター**: ヘッダーの日付選択で期間を絞り込み

## 開発上の注意事項

1. **マップとレイヤー表示のエラーが交互に発生する傾向があるため、修正時は両方の検証が必要**
2. **レイヤー初期化は`map.isStyleLoaded()`がtrueになるまで待機**
3. **データは一度生成してキャッシュ、トグル時の再生成を防止**
4. **サイドバー開閉時は350ms後にmap.resize()を実行**
5. **都道府県切り替え時は`cleanupAllLayers()`でクリーンアップ**
6. **人流ラインは距離グループごとに同期表示（10秒サイクル）**
7. **ビューポートベースでデータを動的に読み込み（パフォーマンス最適化）**

詳細は[CLAUDE.md](./CLAUDE.md)を参照してください。

## ライセンス

Copyright (c) 2025 ダッタラ株式会社
