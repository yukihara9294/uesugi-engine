# 現在の修正状況

## 実施した修正内容

### 1. 複雑な計算式の除去
すべてのMapbox式で算術演算（除算、乗算）を削除し、固定値に置き換えました：

- **宿泊施設**: 3Dレイヤーを無効化し、シンプルな円形マーカーに変更
- **ランドマーク**: 3Dレイヤーを無効化、赤い円形マーカーのみ使用
- **イベント影響範囲**: 除算計算を削除、固定サイズ20に変更
- **消費データ**: 補間計算を削除、固定サイズ10に変更
- **SNSヒートマップ**: weight計算を削除、固定値0.5に変更

### 2. エラーの原因
Mapboxの内部エラー「Cannot read properties of undefined (reading 'sub')」は、
以下のような式で発生していました：
```javascript
['/', ['get', 'value'], 100]  // valueがundefinedの場合エラー
```

### 3. 修正後の表示内容

- **ランドマーク**: 赤い円（半径12px）+ ラベル
- **宿泊施設**: 青い円（半径8px）+ ラベル
- **イベント**: 
  - 影響範囲: 薄い赤い円（半径20px、透明度0.1）
  - マーカー: 赤い円（半径10px）
  - ラベル: イベント名とアイコン
- **消費データ**: 赤い円（半径10px）
- **SNSヒートマップ**: グラデーションヒートマップ
- **人流データ**: （mobility-particles/flowsは別途実装）

### 4. 次のステップ

1. ブラウザを完全リロード（Ctrl+F5）
2. コンソールでエラーが解消されたか確認
3. 各レイヤーのトグルが動作するか確認
4. 地図上にデータが表示されるか確認

もしまだエラーが発生する場合は、より詳細なエラー情報をお知らせください。